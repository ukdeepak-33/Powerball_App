<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Powerball Analysis{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }
        /* Common styling for cards and buttons */
        .btn-primary {
            @apply bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:shadow-outline transition duration-200 ease-in-out;
        }
        .card {
            @apply bg-white p-6 rounded-lg shadow-md;
        }
        .form-group {
            @apply mb-4;
        }
        .form-label {
            @apply block text-gray-700 text-sm font-bold mb-2;
        }
        .form-input {
            @apply shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline;
        }
        .ball {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 45px;
            height: 45px;
            background-color: #f0f0f0;
            border-radius: 50%;
            border: 2px solid #ccc;
            font-weight: bold;
            color: #333;
            font-size: 1.2em;
            margin: 0 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .powerball {
            background-color: #ef4444; /* Red color for powerball */
            color: white;
            border-color: #dc2626;
        }

        /* Sidebar specific styles */
        .sidebar {
            width: 256px; /* Desktop default */
            transition: width 0.3s ease-in-out;
            z-index: 40; /* Ensure it's above main content but below modals */
            position: fixed; /* Keep sidebar fixed on scroll */
            height: 100%; /* Full height */
            overflow-y: auto; /* Enable scrolling for long content */
        }
        .sidebar.open {
            width: 256px;
        }
        @media (max-width: 1023px) {
            .sidebar {
                width: 0; /* Hidden on mobile by default */
                position: fixed;
                left: 0;
                top: 0;
            }
            .sidebar.open {
                width: 256px; /* Open width on mobile */
            }
            .content-area {
                margin-left: 0; /* No margin on mobile */
            }
            .menu-toggle-btn {
                display: block; /* Show hamburger on mobile */
            }
        }
        @media (min-width: 1024px) {
            .content-area {
                margin-left: 256px; /* Desktop margin */
            }
            .menu-toggle-btn {
                display: none; /* Hide hamburger on desktop */
            }
        }
        /* Flash message styling */
        .flash-message {
            @apply p-4 mb-4 rounded-lg;
        }
        .flash-success {
            @apply bg-green-100 text-green-800 border border-green-200;
        }
        .flash-error {
            @apply bg-red-100 text-red-800 border border-red-200;
        }
        .flash-info {
            @apply bg-blue-100 text-blue-800 border border-blue-200;
        }
    </style>
    {# D3.js CDN #}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Common D3 bar chart function
        function drawBarChart(data, elementId, xKey, yKey, title, xLabel, yLabel) {
            if (!data || data.length === 0) {
                document.getElementById(elementId).innerHTML = "<p class='text-gray-500 text-center'>No data available for chart.</p>";
                return;
            }

            const container = document.getElementById(elementId);
            if (!container) {
                console.error(`Container element with ID '${elementId}' not found.`);
                return;
            }

            // Clear previous chart
            container.innerHTML = '';

            const margin = { top: 40, right: 30, bottom: 60, left: 70 };
            const containerWidth = container.clientWidth;
            const containerHeight = 400; // Fixed height for consistency
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;

            const svg = d3.select(`#${elementId}`)
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale
            const xScale = d3.scaleBand()
                .domain(data.map(d => d[xKey]))
                .range([0, width])
                .padding(0.1);

            // Y scale
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d[yKey])]).nice()
                .range([height, 0]);

            // X axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

            // Y axis
            svg.append("g")
                .call(d3.axisLeft(yScale));

            // Bars
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d[xKey]))
                .attr("y", d => yScale(d[yKey]))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d[yKey]))
                .attr("fill", "#4F46E5"); // Indigo-600

            // Title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -margin.top / 2)
                .attr("text-anchor", "middle")
                .attr("font-size", "1.2em")
                .attr("font-weight", "bold")
                .text(title);

            // X-axis label
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 10)
                .attr("text-anchor", "middle")
                .text(xLabel);

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 20)
                .attr("x", -height / 2)
                .attr("text-anchor", "middle")
                .text(yLabel);
        }
    </script>
</head>
<body class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="sidebar bg-gray-800 text-white w-64 p-4 space-y-4 shadow-lg lg:relative">
        <div class="text-2xl font-bold text-center mb-6">
            Powerball App
        </div>
        <nav>
            <ul class="space-y-2">
                <li><a href="{{ url_for('index') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Home / Generate</a></li>
                <li><a href="{{ url_for('frequency_analysis_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Frequency Analysis</a></li>
                <li><a href="{{ url_for('hot_cold_numbers_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Hot/Cold Numbers</a></li>
                <li><a href="{{ url_for('monthly_white_ball_analysis_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Monthly WB Analysis</a></li>
                <li><a href="{{ url_for('sum_of_main_balls_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Sum of Main Balls</a></li>
                <li><a href="{{ url_for('simulate_multiple_draws_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Simulate Draws</a></li>
                <li><a href="{{ url_for('winning_probability_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Winning Probability</a></li>
                <li><a href="{{ url_for('partial_match_probabilities_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Partial Match Prob.</a></li>
                <li><a href="{{ url_for('number_age_distribution_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Number Age Dist.</a></li>
                <li><a href="{{ url_for('co_occurrence_analysis_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Co-Occurrence Matrix</a></li>
                <li><a href="{{ url_for('powerball_position_frequency_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Powerball Position Freq.</a></li>
                <li><a href="{{ url_for('powerball_frequency_by_year_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">PB Freq. by Year</a></li>
                <li><a href="{{ url_for('odd_even_trends_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Odd/Even Trends</a></li>
                <li><a href="{{ url_for('consecutive_trends_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Consecutive Trends</a></li>
                <li><a href="{{ url_for('triplets_analysis_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Triplets Analysis</a></li>
                <li><a href="{{ url_for('grouped_patterns_analysis_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Grouped Patterns</a></li>
                <li><a href="{{ url_for('find_results_by_first_white_ball') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">Find by First WB</a></li>
                <li><a href="{{ url_for('generated_numbers_history_route') }}" class="block py-2 px-4 rounded hover:bg-gray-700 transition duration-200">My Generated Numbers</a></li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 p-6 lg:ml-0 transition-all duration-300 ease-in-out content-area">
        <!-- Mobile Menu Toggle Button -->
        <button id="menuToggle" class="menu-toggle-btn fixed top-4 left-4 bg-gray-800 text-white p-3 rounded-full shadow-lg z-50">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages space-y-3 mb-6">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <h1 class="text-4xl font-extrabold text-gray-900 mb-8 text-center">{% block page_heading %}{% endblock %}</h1>
        
        {% block content %}{% endblock %}
    </div>

    {% block scripts %}
    {# This block is intentionally left to be overridden by child templates if they need to add more scripts. #}
    {# If a child template uses {{ super() }} in its scripts block, it will include the D3 script from here. #}
    {% endblock %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.querySelector('.sidebar');
            const menuToggle = document.getElementById('menuToggle');

            const closeSidebar = () => {
                sidebar.classList.remove('open');
            };

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                });
            }

            // Close sidebar if a link is clicked (mobile only)
            sidebar.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 1024) { // Only on mobile breakpoints
                        closeSidebar();
                    }
                });
            });

            // Close sidebar if clicked outside (only on mobile when opened)
            document.addEventListener('click', (event) => {
                if (window.innerWidth < 1024 && sidebar.classList.contains('open') &&
                    !sidebar.contains(event.target) && (menuToggle && !menuToggle.contains(event.target))) {
                    closeSidebar();
                }
            });

            // Handle initial state and resize for desktop
            const adjustLayoutForDesktop = () => {
                if (window.innerWidth >= 1024) {
                    sidebar.style.width = '256px'; // Ensure fixed width on desktop
                    sidebar.classList.remove('open'); // Ensure 'open' class is not interfering with desktop width
                } else {
                    sidebar.style.width = '0'; // Ensure hidden on mobile initially
                }
            };

            // Run on load and resize
            adjustLayoutForDesktop();
            window.addEventListener('resize', adjustLayoutForDesktop);
        });
    </script>
</body>
</html>
