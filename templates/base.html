<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Powerball Play{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .header {
            background-color: #1a202c; /* Darker header */
            color: #fff;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sidebar {
            background-color: #2d3748; /* Dark blue-gray */
            color: #e2e8f0;
            width: 250px;
            padding: 1.5rem 1rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100%;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .content {
            margin-left: 250px; /* Adjust content to start after sidebar */
            padding: 2rem;
            flex-grow: 1;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* More rounded corners */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer, larger shadow */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0; /* Subtle border */
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a5568;
        }
        .form-group input[type="number"],
        .form-group input[type="text"],
        .form-group select,
        .form-group input[type="date"] { /* Added date input styling */
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.5rem; /* Rounded input fields */
            margin-bottom: 1rem;
            box-sizing: border-box;
        }
        .btn-primary {
            background-color: #4c51bf; /* Deeper indigo */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            transition: background-color 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #5a62c9; /* Lighter indigo on hover */
        }
        .flash-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .flash-message.error {
            background-color: #fed7d7;
            color: #c53030;
            border: 1px solid #fc8181;
        }
        .flash-message.info {
            background-color: #bee3f8;
            color: #2b6cb0;
            border: 1px solid #63b3ed;
        }
        .draw-numbers {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .ball {
            width: 50px; /* Larger balls */
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem; /* Larger font */
            font-weight: bold;
            color: white;
            background-color: #4299e1; /* Blue for white balls */
            border: 2px solid #3182ce;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .powerball {
            background-color: #e53e3e; /* Red for powerball */
            border: 2px solid #c53030;
        }

        .chart-container {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            overflow-x: auto; /* For horizontal scrolling if content is too wide */
        }

        .chart-container svg {
            font-family: 'Inter', sans-serif;
            width: 100%; /* Make SVG responsive */
            height: auto; /* Maintain aspect ratio */
            min-height: 400px; /* Minimum height for readability */
        }
        
        .axis text {
            font-size: 10px;
            fill: #666;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #dcdcdc;
            shape-rendering: crispEdges;
        }
        .bar {
            fill: steelblue;
            transition: fill 0.2s ease-in-out; /* Smooth transition for hover */
        }
        .bar.red {
            fill: #e53e3e; /* Red for Powerball */
        }
        .bar.lightblue {
            fill: #90cdf4; /* Lightblue for cold numbers */
        }
        .bar.orange {
            fill: #f6ad55; /* Orange for specific charts */
        }

        /* Table styles */
        .table-auto {
            width: 100%;
            border-collapse: collapse;
        }
        .table-auto th, .table-auto td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .table-auto th {
            background-color: #edf2f7;
            font-weight: 600;
            color: #2d3748;
            text-transform: uppercase;
            font-size: 0.75rem;
        }
        .table-auto tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        .table-auto tbody tr:nth-child(even) {
            background-color: #f7fafc;
        }
        .table-auto tbody tr:hover {
            background-color: #ebf8ff;
        }

        /* D3 Line Chart specific styles for legend */
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color-box {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <header class="header">
        <div class="text-2xl font-bold flex-grow text-left md:text-center">Powerball Play</div>
    </header>

    <div class="flex flex-grow">
        <aside class="sidebar">
            <nav class="flex-grow">
                <ul class="space-y-2">
                    <li><a href="{{ url_for('index') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Home / Generate Numbers</a></li>
                    <li><a href="{{ url_for('generated_numbers_history_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">View Generated Numbers History</a></li>
                    <li><a href="{{ url_for('frequency_analysis_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Frequency Analysis</a></li>
                    <li><a href="{{ url_for('hot_cold_numbers_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Hot & Cold Numbers</a></li>
                    <li><a href="{{ url_for('monthly_white_ball_analysis_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Monthly White Ball Analysis</a></li>
                    <li><a href="{{ url_for('sum_of_main_balls_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Sum of Main Balls</a></li>
                    <li><a href="{{ url_for('find_results_by_sum_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Find Results by Sum</a></li>
                    <li><a href="{{ url_for('simulate_multiple_draws_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Simulate Multiple Draws</a></li>
                    <li><a href="{{ url_for('winning_probability_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Winning Probability</a></li>
                    <li><a href="{{ url_for('partial_match_probabilities_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Partial Match Probabilities</a></li>
                    <li><a href="{{ url_for('number_age_distribution_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Number Age Distribution</a></li>
                    <li><a href="{{ url_for('co_occurrence_analysis_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Co-Occurrence Analysis</a></li>
                    <li><a href="{{ url_for('powerball_position_frequency_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Powerball Position Frequency</a></li>
                    <li><a href="{{ url_for('find_results_by_first_white_ball') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Find by First White Ball</a></li>
                    <li><a href="{{ url_for('odd_even_trends_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Odd/Even Split Trends</a></li>
                    <li><a href="{{ url_for('consecutive_trends_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Consecutive Numbers Trends</a></li>
                    <li><a href="{{ url_for('triplets_analysis_route') }}" class="block py-1 px-2 text-sm text-indigo-200 hover:bg-indigo-700 rounded transition-colors duration-200">Triplets Analysis</a></li>
                </ul>
            </nav>
            <div class="mt-8 text-center">
                <a href="{{ url_for('update_powerball_data') }}" class="btn-primary inline-block text-sm">Update Daily Data (Simulated)</a>
            </div>
        </aside>

        <main class="content">
            <h1 class="text-3xl font-bold mb-6 text-gray-800">{% block page_heading %}{% endblock %}</h1>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        // Universal D3 Bar Chart Function for Reusability
        // Data: [{ Number: X, Frequency: Y }, ...]
        // ChartId: ID of the div to render into
        // xValueKey: Key for the X-axis value (e.g., "Number", "sum", "age")
        // yValueKey: Key for the Y-axis value (e.g., "Frequency", "count")
        // title: Chart title
        // xLabel: X-axis label
        // yLabel: Y-axis label
        // barColor: CSS color string for bars (optional, defaults to steelblue)
        // prefix: Optional prefix for X-axis labels (e.g., "Ball ")
        function drawBarChart(data, chartId, xValueKey, yValueKey, title, xLabel, yLabel, barColor = "steelblue", prefix = "") {
            d3.select(`#${chartId}`).selectAll("*").remove(); // Clear previous chart

            if (!data || data.length === 0) {
                console.warn(`No data provided for bar chart '${chartId}'.`);
                d3.select(`#${chartId}`).append("p").text("No data available for this chart.");
                return;
            }

            const margin = { top: 30, right: 30, bottom: 60, left: 50 };
            // Adjust width to be responsive up to a max, and maintain padding
            const width = Math.min(800, document.getElementById(chartId).offsetWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            const svg = d3.select(`#${chartId}`)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X scale (band for discrete categories)
            const xScale = d3.scaleBand()
                .range([0, width])
                .padding(0.1)
                .domain(data.map(d => d[xValueKey]));

            // Y scale (linear for frequency)
            const yScale = d3.scaleLinear()
                .range([height, 0])
                .domain([0, d3.max(data, d => d[yValueKey]) * 1.1]); // 10% padding on top

            // Add X axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end")
                .text(d => prefix + d); // Apply prefix to tick labels

            // Add Y axis
            svg.append("g")
                .call(d3.axisLeft(yScale).tickFormat(d3.format("d"))); // Ensure integer ticks for frequency

            // Add bars
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d[xValueKey]))
                .attr("y", d => yScale(d[yValueKey]))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d[yValueKey]))
                .attr("fill", barColor) // Use dynamic bar color
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .attr("fill", d3.color(barColor).brighter(0.8)); // Lighten color on hover

                    // Add text label for value
                    svg.append("text")
                        .attr("class", "bar-value-label")
                        .attr("x", xScale(d[xValueKey]) + xScale.bandwidth() / 2)
                        .attr("y", yScale(d[yValueKey]) - 5) // Position above the bar
                        .attr("text-anchor", "middle")
                        .attr("fill", "#333")
                        .style("font-size", "12px")
                        .style("font-weight", "bold")
                        .text(`${prefix}${d[xValueKey]}: ${d[yValueKey]}`); // Displays both X and Y values
                })
                .on("mouseout", function(event, d) {
                    d3.select(this)
                        .attr("fill", barColor); // Revert to original color

                    // Remove text label
                    svg.selectAll(".bar-value-label").remove();
                });

            // Add title
            svg.append("text")
                .attr("x", (width / 2))
                .attr("y", 0 - (margin.top / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text(title);

            // Add X-axis label
            svg.append("text")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .text(xLabel);

            // Add Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 15)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(yLabel);
        }

    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
