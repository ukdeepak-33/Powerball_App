{% extends "base.html" %}

{% block title %}Generated Numbers History{% endblock %}

{% block page_heading %}Your Generated Numbers History{% endblock %}

{% block content %}
<div class="card p-6 bg-white rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-gray-800">Saved Generated Picks</h2>
    <p class="text-gray-700 mb-4">This section displays all the Powerball combinations you have generated and saved, grouped by date. Click on a date to expand/collapse the list of picks for that day.</p>

    {% if generated_history %}
        <div id="accordion-container" class="space-y-4">
            {% for date, picks in generated_history.items() %}
            <div class="border border-gray-200 rounded-lg overflow-hidden">
                <button class="accordion-header flex justify-between items-center w-full p-4 bg-gray-100 hover:bg-gray-200 focus:outline-none text-left text-lg font-semibold text-gray-800">
                    <span>{{ date }} ({{ picks | length }} picks)</span>
                    <svg class="w-5 h-5 transform transition-transform duration-200 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div class="accordion-content p-4 bg-white border-t border-gray-200 hidden">
                    <ul class="list-none space-y-3">
                        {% for pick in picks %}
                        <li class="flex flex-col sm:flex-row sm:items-center sm:justify-between border-b pb-3 mb-3 last:border-b-0 last:pb-0 last:mb-0">
                            <span class="text-gray-600 text-sm mb-2 sm:mb-0 sm:mr-4">Generated at: <span class="font-medium text-gray-800">{{ pick.time }}</span></span>
                            <div class="flex items-center space-x-2 flex-wrap justify-center sm:justify-start">
                                {% for ball in pick.white_balls %}
                                    <span class="ball-small">{{ ball }}</span>
                                {% endfor %}
                                <span class="ball-small powerball-small">{{ pick.powerball }}</span>
                            </div>
                            <form action="{{ url_for('analyze_generated_historical_matches_route') }}" method="post" class="mt-3 sm:mt-0">
                                <input type="hidden" name="generated_white_balls" value="{{ pick.white_balls | join(',') }}">
                                <input type="hidden" name="generated_powerball" value="{{ pick.powerball }}">
                                <button type="submit" class="btn-primary-small">Analyze Match</button>
                            </form>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800">
            No generated numbers have been saved yet.
        </div>
    {% endif %}
</div>

<style>
    .ball-small {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        width: 30px;
        height: 30px;
        background-color: #f0f0f0;
        border-radius: 50%;
        border: 2px solid #ccc;
        font-weight: bold;
        color: #333;
        font-size: 0.9em;
        box-shadow: inset 0 0 3px rgba(0,0,0,0.2);
    }
    .powerball-small {
        background-color: #ef4444; /* Red color for powerball */
        color: white;
        border-color: #dc2626;
    }
    .btn-primary-small {
        @apply bg-blue-500 text-white text-xs font-bold py-1.5 px-3 rounded-lg hover:bg-blue-600 focus:outline-none focus:shadow-outline transition duration-200 ease-in-out;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accordionHeaders = document.querySelectorAll('.accordion-header');

        accordionHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const icon = this.querySelector('.accordion-icon');

                // Toggle visibility
                content.classList.toggle('hidden');

                // Rotate icon
                if (content.classList.contains('hidden')) {
                    icon.style.transform = 'rotate(0deg)';
                } else {
                    icon.style.transform = 'rotate(180deg)';
                }
            });
        });
    });
</script>
{% endblock %}
