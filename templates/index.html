{% extends "base.html" %}

{% block title %}Powerball Number Generator{% endblock %}

{% block page_heading %}Powerball Number Generator & Analytics{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Section 1: Generate a Random Combination -->
    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Generate a Random Combination</h2>
        <form action="{{ url_for('generate') }}" method="post" class="space-y-4">
            <div class="form-group">
                <label for="odd_even_choice" class="block text-gray-700 text-sm font-bold mb-2">Odd/Even Distribution:</label>
                <select name="odd_even_choice" id="odd_even_choice" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="Any">Any</option>
                    <option value="All Even">All Even (0 Odd / 5 Even)</option>
                    <option value="All Odd">All Odd (5 Odd / 0 Even)</option>
                    <option value="3 Even / 2 Odd">3 Even / 2 Odd</option>
                    <option value="3 Odd / 2 Even">3 Odd / 2 Even</option>
                    <option value="1 Even / 4 Odd">1 Even / 4 Odd</option>
                    <option value="1 Odd / 4 Even">1 Odd / 4 Even</option>
                </select>
            </div>
            <div class="form-group">
                <label for="high_low_balance" class="block text-gray-700 text-sm font-bold mb-2">High/Low Balance (e.g., "2 3" for 2 low, 3 high - low=1-34, high=35-69):</label>
                <input type="text" name="high_low_balance" id="high_low_balance" placeholder="e.g., 2 3"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="form-group">
                <label for="white_ball_min" class="block text-gray-700 text-sm font-bold mb-2">White Ball Range (Min 1 - Max 69):</label>
                <input type="number" name="white_ball_min" id="white_ball_min" min="1" max="69" value="1"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <input type="number" name="white_ball_max" id="white_ball_max" min="1" max="69" value="69"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-2">
            </div>
            <div class="form-group">
                <label for="powerball_min" class="block text-gray-700 text-sm font-bold mb-2">Powerball Range (Min 1 - Max 26):</label>
                <input type="number" name="powerball_min" id="powerball_min" min="1" max="26" value="1"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <input type="number" name="powerball_max" id="powerball_max" min="1" max="26" value="26"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-2">
            </div>
            <div class="form-group">
                <label for="excluded_numbers" class="block text-gray-700 text-sm font-bold mb-2">Excluded Numbers (comma-separated, e.g., 7,14,21):</label>
                <input type="text" name="excluded_numbers" id="excluded_numbers" placeholder="e.g., 1, 10, 20"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <button type="submit" class="btn-primary w-full">Generate Combination</button>
        </form>
    </div>

    <!-- Section 2: Modify Existing Combination (using a random historical draw as base) -->
    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Modify an Existing Combination</h2>
        <p class="text-gray-700 mb-4">This will pick a random historical draw, modify 3 white balls and the Powerball, and present a new combination.</p>
        <form action="{{ url_for('generate_modified') }}" method="post" class="space-y-4">
            <div class="form-group">
                <input type="checkbox" id="use_common_pairs" name="use_common_pairs" class="mr-2">
                <label for="use_common_pairs" class="text-gray-700 text-sm font-bold">Generate using Top Common Pairs (Overrides random modification)</label>
            </div>
            <div id="num_range_field" class="form-group hidden">
                <label for="num_range" class="block text-gray-700 text-sm font-bold mb-2">Filter Common Pairs by Range (Min Max, e.g., "1 20"):</label>
                <input type="text" name="num_range" id="num_range" placeholder="e.g., 1 20"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <button type="submit" class="btn-primary w-full">Generate Modified Combination</button>
        </form>
    </div>

    <!-- Section 3: Added Group A Strategy -->
    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Generate with Group A Strategy</h2>
        <p class="text-gray-700 mb-4">Generates numbers ensuring a specified count comes from a predefined 'Group A' set of numbers (3, 5, 6, 7, 9, 11, 15, 16, 18, 21, 23, 24, 27, 31, 32, 33, 36, 42, 44, 45, 48, 50, 51, 54, 55, 60, 66, 69), with the rest from the remaining pool.</p>
        <form action="{{ url_for('generate_group_a_strategy_route') }}" method="post" class="space-y-4">
            <div class="form-group">
                <label for="num_from_group_a" class="block text-gray-700 text-sm font-bold mb-2">Number of White Balls from Group A (1-5):</label>
                <input type="number" name="num_from_group_a" id="num_from_group_a" min="1" max="5" value="2"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
             <div class="form-group">
                <label for="white_ball_min_group_a" class="block text-gray-700 text-sm font-bold mb-2">White Ball Range (Min 1 - Max 69):</label>
                <input type="number" name="white_ball_min" id="white_ball_min_group_a" min="1" max="69" value="1"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <input type="number" name="white_ball_max" id="white_ball_max_group_a" min="1" max="69" value="69"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-2">
            </div>
            <div class="form-group">
                <label for="powerball_min_group_a" class="block text-gray-700 text-sm font-bold mb-2">Powerball Range (Min 1 - Max 26):</label>
                <input type="number" name="powerball_min" id="powerball_min_group_a" min="1" max="26" value="1"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <input type="number" name="powerball_max" id="powerball_max_group_a" min="1" max="26" value="26"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-2">
            </div>
            <div class="form-group">
                <label for="excluded_numbers_group_a" class="block text-gray-700 text-sm font-bold mb-2">Excluded Numbers (comma-separated, e.g., 7,14,21):</label>
                <input type="text" name="excluded_numbers" id="excluded_numbers_group_a" placeholder="e.g., 1, 10, 20"
                       class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <button type="submit" class="btn-primary w-full">Generate Group A Combination</button>
        </form>
    </div>

    <!-- Generated Numbers Display -->
    {% if white_balls and powerball is not none %}
    <div class="card p-6 rounded-lg shadow-lg 
        {% if generation_type == 'generated' %}bg-blue-100 border-blue-400
        {% elif generation_type == 'modified' %}bg-green-100 border-green-400
        {% elif generation_type == 'group_a_strategy' %}bg-orange-100 border-orange-400
        {% endif %} border-2">
        <h2 class="text-2xl font-bold mb-4 
            {% if generation_type == 'generated' %}text-blue-800
            {% elif generation_type == 'modified' %}text-green-800
            {% elif generation_type == 'group_a_strategy' %}text-orange-800
            {% endif %}">
            Your Generated Numbers:
        </h2>
        <div class="draw-numbers mb-4">
            {% for ball in white_balls %}
                <span class="ball">{{ ball }}</span>
            {% endfor %}
            <span class="ball powerball">{{ powerball }}</span>
        </div>
        <p class="text-gray-700 text-center mb-4">
            Generated Type: 
            <span class="font-semibold 
                {% if generation_type == 'generated' %}text-blue-700
                {% elif generation_type == 'modified' %}text-green-700
                {% elif generation_type == 'group_a_strategy' %}text-orange-700
                {% endif %}">
                {{ generation_type | replace('_', ' ') | title }}
            </span>
        </p>

        {% if last_draw_dates %}
            <div class="bg-gray-50 p-4 rounded-lg mt-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Last Appearance Dates:</h3>
                <ul class="list-disc list-inside text-gray-700">
                    {% for number, date in last_draw_dates.items() %}
                        <li>{{ number }}: {{ date }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <div class="mt-6 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
            <form action="{{ url_for('save_generated_pick_route') }}" method="post">
                <input type="hidden" name="generated_white_balls" value="{{ white_balls | join(',') }}">
                <input type="hidden" name="generated_powerball" value="{{ powerball }}">
                <button type="submit" class="btn-primary w-full">Save This Pick</button>
            </form>
            <form action="{{ url_for('analyze_generated_historical_matches_route') }}" method="post">
                <input type="hidden" name="generated_white_balls" value="{{ white_balls | join(',') }}">
                <input type="hidden" name="generated_powerball" value="{{ powerball }}">
                <button type="submit" class="btn-primary w-full bg-purple-600 hover:bg-purple-700">Analyze Against History</button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Last Official Draw Display -->
    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Last Official Powerball Draw</h2>
        {% if last_draw and last_draw['Draw Date'] != 'N/A' %}
        <p class="text-lg text-gray-700 mb-2"><strong>Draw Date:</strong> {{ last_draw['Draw Date'] }}</p>
        <div class="draw-numbers mb-4">
            {% for ball in last_draw.Numbers %}
                <span class="ball">{{ ball }}</span>
            {% endfor %}
            <span class="ball powerball">{{ last_draw['Powerball'] }}</span>
        </div>
        {% else %}
        <p class="text-gray-700">Last draw information not available. Please ensure data is loaded.</p>
        {% endif %}
        <div class="mt-4">
            <form action="{{ url_for('save_official_draw_route') }}" method="post" class="space-y-3">
                <h3 class="text-xl font-semibold text-gray-800 mb-3">Add Official Draw (Manual Entry)</h3>
                <div class="form-group">
                    <label for="draw_date" class="block text-gray-700 text-sm font-bold mb-2">Draw Date:</label>
                    <input type="date" name="draw_date" id="draw_date" required
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="grid grid-cols-5 gap-2">
                    {% for i in range(1, 6) %}
                    <div class="form-group">
                        <label for="n{{ i }}" class="block text-gray-700 text-sm font-bold mb-1">N{{ i }}:</label>
                        <input type="number" name="n{{ i }}" id="n{{ i }}" min="1" max="69" required
                               class="shadow appearance-none border rounded-lg w-full py-2 px-2 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    {% endfor %}
                </div>
                <div class="form-group mt-4">
                    <label for="pb" class="block text-gray-700 text-sm font-bold mb-2">Powerball:</label>
                    <input type="number" name="pb" id="pb" min="1" max="26" required
                           class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <button type="submit" class="btn-primary w-full">Save Official Draw</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const useCommonPairsCheckbox = document.getElementById('use_common_pairs');
        const numRangeField = document.getElementById('num_range_field');

        // Initial state
        if (useCommonPairsCheckbox && useCommonPairsCheckbox.checked) {
            numRangeField.classList.remove('hidden');
        } else if (numRangeField) {
            numRangeField.classList.add('hidden');
        }

        // Add event listener for changes
        if (useCommonPairsCheckbox) {
            useCommonPairsCheckbox.addEventListener('change', function() {
                if (numRangeField) {
                    if (this.checked) {
                        numRangeField.classList.remove('hidden');
                    } else {
                        numRangeField.classList.add('hidden');
                    }
                }
            });
        }
    });
</script>
{% endblock %}
