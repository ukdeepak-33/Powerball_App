{% extends "base.html" %}

{% block title %}Powerball Analysis{% endblock %}

{% block page_heading %}Powerball Analysis & Generation{% endblock %}

{% block content %}
<div class="space-y-8">
    {# Flash messages display #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages space-y-3">
                {% for category, message in messages %}
                    <div class="p-3 rounded-lg text-sm {% if category == 'error' %}bg-red-100 text-red-700{% elif category == 'info' %}bg-blue-100 text-blue-700{% else %}bg-green-100 text-green-700{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Latest Powerball Draw</h2>
        {% if last_draw %}
        <div class="text-lg mb-4">
            <p><span class="font-semibold">Draw Date:</span> {{ last_draw['Draw Date'] }}</p>
            <div class="flex items-center space-x-2 mt-2">
                <span class="font-semibold">Numbers:</span>
                {% for num in last_draw['Numbers'] %}
                    <span class="ball">{{ num }}</span>
                {% endfor %}
                <span class="powerball-label">PB:</span>
                <span class="powerball-ball">{{ last_draw['Powerball'] }}</span>
            </div>
        </div>
        {% else %}
        <p class="text-gray-500">No historical draw data available.</p>
        {% endif %}
    </div>

    {# Display generated numbers #}
    {% if white_balls and powerball %}
    <div class="card p-6 bg-white rounded-lg shadow-lg animate-fade-in">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Your Generated Numbers!</h2>
        <div class="flex items-center space-x-3 text-2xl mb-4">
            {% for num in white_balls %}
                <span class="ball animated-ball">{{ num }}</span>
            {% endfor %}
            <span class="powerball-label">PB:</span>
            <span class="powerball-ball animated-ball">{{ powerball }}</span>
        </div>

        {# Last Drawn Dates Section #}
        {% if last_draw_dates %}
        <div class="mt-6 border-t pt-4 border-gray-200">
            <h3 class="text-xl font-semibold mb-3 text-gray-700">Last Drawn Dates:</h3>
            <ul class="list-disc list-inside text-gray-600 space-y-1">
                {% for ball_info, draw_date in last_draw_dates.items() %}
                    <li><span class="font-medium">{{ ball_info }}:</span> {{ draw_date }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="mt-6 flex flex-wrap gap-4">
            <form action="{{ url_for('save_generated_pick_route') }}" method="post">
                <input type="hidden" name="generated_white_balls" value="{{ white_balls | join(',') }}">
                <input type="hidden" name="generated_powerball" value="{{ powerball }}">
                <button type="submit" class="btn-primary flex items-center px-6 py-3">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-3m-1-4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                    Save This Pick
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {# Generate Random Numbers Card #}
        <div class="card p-6 bg-white rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Generate Random Numbers</h2>
            <form action="{{ url_for('generate') }}" method="post" class="space-y-4">
                <div class="form-group">
                    <label for="odd_even_choice" class="form-label">Odd/Even Split:</label>
                    <select name="odd_even_choice" id="odd_even_choice" class="form-input">
                        <option value="Any">Any</option>
                        <option value="All Even">All Even (5 Even / 0 Odd)</option>
                        <option value="All Odd">All Odd (0 Even / 5 Odd)</option>
                        <option value="3 Even / 2 Odd">3 Even / 2 Odd</option>
                        <option value="2 Even / 3 Odd">2 Even / 3 Odd</option>
                        <option value="4 Even / 1 Odd">4 Even / 1 Odd</option>
                        <option value="1 Even / 4 Odd">1 Even / 4 Odd</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="high_low_balance" class="form-label">High/Low Balance (e.g., "2 3" for 2 low, 3 high):</label>
                    <input type="text" name="high_low_balance" id="high_low_balance" class="form-input" placeholder="e.g., 2 3">
                </div>
                <div class="form-group">
                    <label for="excluded_numbers" class="form-label">Exclude Numbers (comma-separated):</label>
                    <input type="text" name="excluded_numbers" id="excluded_numbers" class="form-input" placeholder="e.g., 1, 7, 42">
                </div>
                <button type="submit" class="btn-primary w-full">Generate Random</button>
            </form>
        </div>

        {# Generate from Group A Card #}
        <div class="card p-6 bg-white rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Generate from Group A</h2>
            <p class="text-gray-600 mb-4">Generate numbers with a specified count of 'Group A' numbers.</p>
            <form action="{{ url_for('generate_group_a_strategy_route') }}" method="post" class="space-y-4"> {# Corrected endpoint name here #}
                <div class="form-group">
                    <label for="num_from_group_a" class="form-label">Numbers from Group A (min 2):</label>
                    <input type="number" name="num_from_group_a" id="num_from_group_a" min="2" max="5" value="2" class="form-input">
                </div>
                <div class="form-group">
                    <label for="excluded_numbers_group_a" class="form-label">Exclude Numbers (comma-separated):</label>
                    <input type="text" name="excluded_numbers" id="excluded_numbers_group_a" class="form-input" placeholder="e.g., 1, 7, 42">
                </div>
                <button type="submit" class="btn-primary w-full">Generate from Group A</button>
            </form>
        </div>

        {# Generate from Your Starting Pair Card #}
        <div class="card p-6 bg-white rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Generate from Your Starting Pair</h2>
            <p class="text-gray-600 mb-4">Provided two white balls to start your combination. The remaining three white balls and the Powerball will be randomly generated, ensuring the complete set of 5 white balls is unique historically.</p>
            <form action="{{ url_for('generate_with_user_pair_route') }}" method="post" class="space-y-4">
                <div class="form-group">
                    <label for="user_pair" class="form-label">Enter Two White Balls (comma-separated, e.g., 18, 19):</label>
                    <input type="text" name="user_pair" id="user_pair" class="form-input" placeholder="e.g., 18, 19">
                </div>
                <button type="submit" class="btn-primary w-full">Generate with Pair</button>
            </form>
        </div>
    </div>

    <div class="card p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Manually Add Official Draw</h2>
        <form action="{{ url_for('save_official_draw_route') }}" method="post" class="space-y-4">
            <div class="form-group">
                <label for="draw_date" class="form-label">Draw Date:</label>
                <input type="date" name="draw_date" id="draw_date" class="form-input" required>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <div class="form-group">
                    <label for="n1" class="form-label">N1:</label>
                    <input type="number" name="n1" id="n1" min="1" max="69" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="n2" class="form-label">N2:</label>
                    <input type="number" name="n2" id="n2" min="1" max="69" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="n3" class="form-label">N3:</label>
                    <input type="number" name="n3" id="n3" min="1" max="69" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="n4" class="form-label">N4:</label>
                    <input type="number" name="n4" id="n4" min="1" max="69" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="n5" class="form-label">N5:</label>
                    <input type="number" name="n5" id="n5" min="1" max="69" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="pb" class="form-label">PB:</label>
                    <input type="number" name="pb" id="pb" min="1" max="26" class="form-input" required>
                </div>
            </div>
            <button type="submit" class="btn-primary w-full">Save Official Draw</button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Set today's date as default for the draw_date input
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('draw_date').value = `${yyyy}-${mm}-${dd}`;
    });

    // Animate generated balls on load
    document.querySelectorAll('.animated-ball').forEach((ball, index) => {
        ball.style.animationDelay = `${index * 0.1}s`;
    });
</script>
{% endblock %}
