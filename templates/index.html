<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powerball Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js for charts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        .card {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #475569;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: #334155;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #6366f1;
            color: #ffffff;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
            border: none;
        }
        .btn:hover {
            background-color: #4f46e5;
            transform: translateY(-1px);
        }
        .btn:active {
            background-color: #4338ca;
            transform: translateY(0);
        }
        .number-display {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .ball {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background-color: #f97316; /* Orange for white balls */
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        .powerball {
            background-color: #dc2626; /* Red for powerball */
        }
        .flash-message {
            background-color: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #eef2f6;
            font-weight: 600;
            color: #475569;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .accordion-header {
            background-color: #f8fafc;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #334155;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
            transition: background-color 0.2s;
        }
        .accordion-header:hover {
            background-color: #eef2f6;
        }
        .accordion-content {
            padding: 0 1.5rem 1.5rem 1.5rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            margin-bottom: 1rem;
        }
        .accordion-content.active {
            max-height: 2000px; /* Arbitrarily large value, ensure it's enough for content */
            padding: 1.5rem;
            opacity: 1;
            pointer-events: auto;
            transition: max-height 0.5s ease-in, padding 0.5s ease-in, opacity 0.5s ease-in;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-header.active .accordion-icon {
            transform: rotate(90deg);
        }
        /* Custom styles for scrollable tables */
        .scrollable-table-container {
            max-height: 400px; /* Adjust as needed */
            overflow-y: auto;
            border: 1px solid #e2e8f0; /* Optional: adds a border around the scrollable area */
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .scrollable-table-container table {
            margin-top: 0; /* Remove top margin from table inside container */
        }
        .scrollable-table-container thead th {
            position: sticky;
            top: 0;
            background-color: #eef2f6;
            z-index: 10;
        }
        /* D3 Chart specific styles */
        .chart-container {
            width: 100%;
            overflow-x: auto; /* Allow horizontal scroll if bars are too many */
            padding-bottom: 20px; /* Space for x-axis labels */
        }
        .bar {
            fill: #6366f1; /* Indigo */
        }
        .bar:hover {
            fill: #4f46e5; /* Darker Indigo on hover */
        }
        .axis text {
            font-size: 0.75rem;
            fill: #475569;
        }
        .axis path, .axis line {
            stroke: #cbd5e1;
            shape-rendering: crispEdges;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: auto;
            height: auto;
            padding: 8px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
        }
        /* Heatmap specific styles */
        .heatmap-cell {
            stroke: #fff;
            stroke-width: 0.5px;
        }
        .heatmap-cell:hover {
            stroke: #000;
            stroke-width: 1.5px;
        }
        .scatter-point {
            fill: #6366f1; /* Indigo */
            opacity: 0.7;
        }
        .scatter-point:hover {
            opacity: 1;
            fill: #4f46e5;
        }
        .area-path {
            fill: steelblue;
            opacity: 0.7;
        }
        .area-path:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-6 lg:p-8">
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-8">Powerball Simulator</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ 'bg-green-100 text-green-700' if category == 'info' else 'bg-red-100 text-red-700' }} mb-4 p-3 rounded-lg">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Last Draw Result -->
        <div class="card mb-8">
            <h2 class="text-2xl font-bold text-indigo-600 mb-4">Last Powerball Draw:</h2>
            {% if last_draw and last_draw['Draw Date'] != 'N/A' %}
                <p class="text-lg mb-2"><span class="font-semibold">Draw Date:</span> {{ last_draw['Draw Date'] }}</p>
                <div class="number-display">
                    {% for i in range(1, 6) %}
                        <div class="ball">{{ last_draw['Number ' + i|string] }}</div>
                    {% endfor %}
                    <div class="ball powerball">{{ last_draw['Powerball'] }}</div>
                </div>
            {% else %}
                <p class="text-lg text-gray-600">No last draw data available (check data file).</p>
            {% endif %}
        </div>

        <!-- Accordion for sections -->
        <div class="space-y-4">
            <!-- Generate Numbers Section -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Generate New Numbers</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/generate" method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="odd_even_choice" class="form-label">Odd/Even Distribution:</label>
                            <select id="odd_even_choice" name="odd_even_choice" class="form-select">
                                <option value="Any">Any</option>
                                <option value="All Even">All Even</option>
                                <option value="All Odd">All Odd</option>
                                <option value="3 Even / 2 Odd">3 Even / 2 Odd</option>
                                <option value="3 Odd / 2 Even">3 Odd / 2 Even</option>
                                <option value="1 Even / 4 Odd">1 Even / 4 Odd</option>
                                <option value="1 Odd / 4 Even">1 Odd / 4 Even</option>
                            </select>
                        </div>
                        <div>
                            <label for="combo_choice" class="form-label">Combo Choice:</label>
                            <select id="combo_choice" name="combo_choice" class="form-select">
                                <option value="No Combo">No Combo</option>
                                <option value="2-combo">2-combo</option>
                                <option value="3-combo">3-combo</option>
                            </select>
                        </div>
                        <div>
                            <label for="white_ball_min" class="form-label">White Ball Min (1-69):</label>
                            <input type="number" id="white_ball_min" name="white_ball_min" value="1" min="1" max="69" class="form-input">
                        </div>
                        <div>
                            <label for="white_ball_max" class="form-label">White Ball Max (1-69):</label>
                            <input type="number" id="white_ball_max" name="white_ball_max" value="69" min="1" max="69" class="form-input">
                        </div>
                        <div>
                            <label for="powerball_min" class="form-label">Powerball Min (1-26):</label>
                            <input type="number" id="powerball_min" name="powerball_min" value="1" min="1" max="26" class="form-input">
                        </div>
                        <div>
                            <label for="powerball_max" class="form-label">Powerball Max (1-26):</label>
                            <input type="number" id="powerball_max" name="powerball_max" value="26" min="1" max="26" class="form-input">
                        </div>
                        <div class="md:col-span-2">
                            <label for="excluded_numbers" class="form-label">Excluded Numbers (comma-separated):</label>
                            <input type="text" id="excluded_numbers" name="excluded_numbers" placeholder="e.g., 1, 10, 25" class="form-input">
                        </div>
                        <div class="md:col-span-2">
                            <label for="high_low_balance" class="form-label">High/Low Balance (e.g., 2 3 for 2 low, 3 high):</label>
                            <input type="text" id="high_low_balance" name="high_low_balance" placeholder="e.g., 2 3 (Low <=34, High >=35)" class="form-input">
                        </div>
                        <div class="md:col-span-2 flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Generate Numbers</button>
                        </div>
                    </form>

                    {% if white_balls and powerball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Your Generated Numbers:</h3>
                        <div class="number-display">
                            {% for ball in white_balls %}
                                <div class="ball">{{ ball }}</div>
                            {% endfor %}
                            <div class="ball powerball">{{ powerball }}</div>
                        </div>
                        {% if last_draw_dates %}
                            <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Last Drawn Dates for Your Numbers:</h4>
                            <ul class="list-disc list-inside text-center">
                                {% for number, date in last_draw_dates.items() %}
                                    <li><span class="font-medium">{{ number }}:</span> {{ date }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Generate Modified Combinations Section -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Generate Modified Combination</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/generate_modified" method="post" class="grid grid-cols-1 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="use_common_pairs" name="use_common_pairs" class="mr-2 rounded-md">
                            <label for="use_common_pairs" class="form-label mb-0">Use Common Pairs for first two numbers</label>
                        </div>
                        <div>
                            <label for="num_range" class="form-label">Filter Common Pairs by Range (e.g., 1 20):</label>
                            <input type="text" id="num_range" name="num_range" placeholder="e.g., 1 20" class="form-input">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Generate Modified Combination</button>
                        </div>
                    </form>
                    {% if white_balls and powerball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Your Modified Numbers:</h3>
                        <div class="number-display">
                            {% for ball in white_balls %}
                                <div class="ball">{{ ball }}</div>
                            {% endfor %}
                            <div class="ball powerball">{{ powerball }}</div>
                        </div>
                        {% if last_draw_dates %}
                            <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Last Drawn Dates for Your Numbers:</h4>
                            <ul class="list-disc list-inside text-center">
                                {% for number, date in last_draw_dates.items() %}
                                    <li><span class="font-medium">{{ number }}:</span> {{ date }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Find Results by First White Ball Section -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Find Results by First White Ball Number</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/find_results_by_first_white_ball" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="white_ball_number" class="form-label">Enter First White Ball Number (1-69):</label>
                            <input type="number" id="white_ball_number" name="white_ball_number" min="1" max="69" required class="form-input" value="{{ white_ball_number if white_ball_number is defined else '' }}">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="sort_by_year" name="sort_by_year" class="mr-2 rounded-md" {% if sort_by_year %}checked{% endif %}>
                            <label for="sort_by_year" class="form-label mb-0">Sort by Year</label>
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Find Results</button>
                        </div>
                    </form>
                    {% if results_by_first_white_ball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Results for First White Ball: {{ white_ball_number }}</h3>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Number 1</th>
                                        <th>Number 2</th>
                                        <th>Number 3</th>
                                        <th>Number 4</th>
                                        <th>Number 5</th>
                                        <th>Powerball</th>
                                        {% if sort_by_year %}<th>Year</th>{% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for result in results_by_first_white_ball %}
                                        <tr>
                                            <td>{{ result['Draw Date'] }}</td>
                                            <td>{{ result['Number 1'] }}</td>
                                            <td>{{ result['Number 2'] }}</td>
                                            <td>{{ result['Number 3'] }}</td>
                                            <td>{{ result['Number 4'] }}</td>
                                            <td>{{ result['Number 5'] }}</td>
                                            <td>{{ result['Powerball'] }}</td>
                                            {% if sort_by_year %}<td>{{ result['Year'] }}</td>{% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif white_ball_number is defined %}
                        <p class="text-lg text-gray-600 text-center mt-4">No results found for first white ball number {{ white_ball_number }}.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Analysis Tools Section -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Analysis Tools</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <h3 class="text-xl font-bold text-indigo-600 mb-4">Frequency Analysis:</h3>
                    <form action="/frequency_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Frequency Analysis</button>
                    </form>
                    {% if white_ball_freq and powerball_freq %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">White Ball Frequencies (All Time):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in white_ball_freq %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Powerball Frequencies (All Time):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in powerball_freq %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Hot and Cold Numbers:</h3>
                    <form action="/hot_cold_numbers" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Hot and Cold Numbers</button>
                    </form>
                    {% if hot_numbers and cold_numbers %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Hot Numbers (Last Year):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in hot_numbers %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Cold Numbers (Last Year):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in cold_numbers %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Monthly White Ball Analysis (Last 6 Months):</h3>
                    <form action="/monthly_white_ball_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Monthly Analysis</button>
                    </form>
                    {% if monthly_balls %}
                        <div class="scrollable-table-container p-2">
                            {% for month, balls in monthly_balls.items() %}
                                <h4 class="text-lg font-semibold text-gray-700 mb-2 mt-4">{{ month }}:</h4>
                                <p class="mb-4 text-sm break-words">{{ balls | join(', ') }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- Removed Hit and Miss Analysis Section -->
                    {#
                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Hit and Miss Analysis:</h3>
                    <form action="/hit_and_miss_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Hit and Miss</button>
                    </form>
                    {% if white_ball_hit_miss and powerball_hit_miss %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">White Ball Miss Streaks:</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Miss Streak (Draws)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in white_ball_hit_miss %}
                                                <tr>
                                                    <td>{{ row['number'] }}</td>
                                                    <td>{{ row['miss_streak'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Powerball Miss Streaks:</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Miss Streak (Draws)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in powerball_hit_miss %}
                                                <tr>
                                                    <td>{{ row['number'] }}</td>
                                                    <td>{{ row['miss_streak'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    #}

                    <!-- NEW: Number Age Distribution Chart -->
                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Number Age Distribution:</h3>
                    <form action="/number_age_distribution" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Number Age Chart</button>
                    </form>
                    {% if number_age_data %}
                        <div id="number-age-chart" class="chart-container"></div>
                        <p class="text-sm text-gray-500 text-center mt-2">Frequency of numbers based on draws since last appearance.</p>
                    {% endif %}

                    <!-- NEW: Number Co-occurrence Heatmap -->
                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Number Co-occurrence:</h3>
                    <form action="/co_occurrence_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Co-occurrence Heatmap</button>
                    </form>
                    {% if co_occurrence_data %}
                        <div id="co-occurrence-chart" class="chart-container"></div>
                        <p class="text-sm text-gray-500 text-center mt-2">How often pairs of white balls appear together.</p>
                    {% endif %}
                    
                    <!-- NEW: Powerball Position Frequency Scatter Plot -->
                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Powerball Position Frequency:</h3>
                    <form action="/powerball_position_frequency" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Powerball Position</button>
                    </form>
                    {% if powerball_position_data %}
                        <div id="powerball-position-chart" class="chart-container"></div>
                        <p class="text-sm text-gray-500 text-center mt-2">Powerball number vs. position of white balls in the draw.</p>
                    {% endif %}


                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Sum of Main Balls:</h3>
                    <form action="/sum_of_main_balls" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Sum of Main Balls Analysis</button>
                    </form>
                    {% if sum_data %}
                        <div class="bg-gray-50 p-4 rounded-lg shadow-inner mb-6 text-center">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Summary Statistics:</h4>
                            <p class="text-md">Min Sum: <span class="font-bold">{{ min_sum }}</span> | 
                               Max Sum: <span class="font-bold">{{ max_sum }}</span> | 
                               Average Sum: <span class="font-bold">{{ avg_sum }}</span></p>
                        </div>
                        
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Sum Distribution (Area Chart):</h4>
                        <div id="sum-distribution-chart" class="chart-container"></div>
                        <p class="text-sm text-gray-500 text-center mt-2">Frequency distribution of the sum of white balls.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-2 mt-6">All Sums Data:</h4>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Sum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in sum_data %}
                                        <tr>
                                            <td>{{ row['Draw Date'] }}</td>
                                            <td>{{ row['Sum'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Find Results by Sum:</h3>
                    <form action="/find_results_by_sum" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="target_sum" class="form-label">Target Sum of White Balls:</label>
                            <input type="number" id="target_sum" name="target_sum" min="15" max="345" required class="form-input" value="{{ target_sum if target_sum is defined else '' }}">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Find Results by Sum</button>
                        </div>
                    </form>
                    {% if results %}
                        <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Results with Sum {{ target_sum }}:</h4>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Number 1</th>
                                        <th>Number 2</th>
                                        <th>Number 3</th>
                                        <th>Number 4</th>
                                        <th>Number 5</th>
                                        <th>Sum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in results %}
                                        <tr>
                                            <td>{{ row['Draw Date'] }}</td>
                                            <td>{{ row['Number 1'] }}</td>
                                            <td>{{ row['Number 2'] }}</td>
                                            <td>{{ row['Number 3'] }}</td>
                                            <td>{{ row['Number 4'] }}</td>
                                            <td>{{ row['Number 5'] }}</td>
                                            <td>{{ row['Sum'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif target_sum is defined %}
                        <p class="text-lg text-gray-600 text-center mt-4">No results found for target sum {{ target_sum }}.</p>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Simulate Multiple Draws:</h3>
                    <form action="/simulate_multiple_draws" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="num_draws" class="form-label">Number of Simulations:</label>
                            <input type="number" id="num_draws" name="num_draws" value="100" min="1" required class="form-input">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Run Simulation</button>
                        </div>
                    </form>
                    {% if simulated_freq %}
                        <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Frequency of Numbers in {{ num_simulations }} Simulated Draws:</h4>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Number</th>
                                        <th>Frequency</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in simulated_freq %}
                                        <tr>
                                            <td>{{ row['Number'] }}</td>
                                            <td>{{ row['Frequency'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                </div>
            </div>

            <!-- Probability Calculations Section -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Probability Calculations</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <h3 class="text-xl font-bold text-indigo-600 mb-4">Winning Probability:</h3>
                    <form action="/winning_probability" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">Calculate Winning Probability</button>
                    </form>
                    {% if probability_1_in_x and probability_percentage %}
                        <p class="text-lg mb-2"><span class="font-semibold">Overall Winning Probability:</span> {{ probability_1_in_x }}</p>
                        <p class="text-lg mb-2"><span class="font-semibold">As Percentage:</span> {{ probability_percentage }}</p>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Partial Match Probabilities:</h3>
                    <form action="/partial_match_probabilities" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">Calculate Partial Match Probabilities</button>
                    </form>
                    {% if probabilities %}
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Match Scenario</th>
                                        <th>Odds</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for scenario, odds in probabilities.items() %}
                                        <tr>
                                            <td>{{ scenario }}</td>
                                            <td>{{ odds }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Export Analysis Results -->
            <div class="accordion-item">
                <div class="accordion-header" >
                    <span>Export Analysis Results</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <p class="text-lg mb-4 text-gray-700">Click the button below to export current analysis results to a CSV file (analysis_results.csv).</p>
                    <form action="/export_analysis_results" method="get" class="text-center">
                        <button type="submit" class="btn w-full max-w-xs">Export to CSV</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data variables for D3 charts, safely passed from Flask
        const sumFreqData = {{ sum_freq_list | tojson if sum_freq_list is defined else '[]' }};
        const numberAgeData = {{ number_age_data | tojson if number_age_data is defined else '[]' }};
        const coOccurrenceData = {{ co_occurrence_data | tojson if co_occurrence_data is defined else '[]' }};
        const maxCoOccurrence = {{ max_co_occurrence if max_co_occurrence is defined else '0' }};
        const powerballPositionData = {{ powerball_position_data | tojson if powerball_position_data is defined else '[]' }};


        function toggleAccordion(header) {
            header.classList.toggle('active');
            const content = header.nextElementSibling;
            if (content.classList.contains('active')) {
                content.classList.remove('active');
            } else {
                content.classList.add('active');
                
                // --- Render Charts within this section when opened ---
                if (content.querySelector('#sum-distribution-chart') && typeof renderSumChart === 'function' && sumFreqData && sumFreqData.length > 0) {
                    renderSumChart(sumFreqData);
                }
                if (content.querySelector('#number-age-chart') && typeof renderNumberAgeChart === 'function' && numberAgeData && numberAgeData.length > 0) {
                    renderNumberAgeChart(numberAgeData);
                }
                if (content.querySelector('#co-occurrence-chart') && typeof renderCoOccurrenceChart === 'function' && coOccurrenceData && coOccurrenceData.length > 0) {
                    renderCoOccurrenceChart(coOccurrenceData, maxCoOccurrence);
                }
                if (content.querySelector('#powerball-position-chart') && typeof renderPowerballPositionChart === 'function' && powerballPositionData && powerballPositionData.length > 0) {
                    renderPowerballPositionChart(powerballPositionData);
                }
            }
        }

        // --- D3.js Chart Rendering Functions ---

        // Draw Sum Zones (Area Chart) - Modified from previous bar chart
        function renderSumChart(data) {
            const container = d3.select("#sum-distribution-chart");
            container.html(""); // Clear any existing chart

            if (!data || data.length === 0) {
                container.append("p").text("No sum frequency data available to display chart.").style("text-align", "center").style("color", "#6b7280");
                return;
            }

            const margin = { top: 20, right: 30, bottom: 50, left: 40 };
            const containerWidth = container.node().getBoundingClientRect().width;
            const width = Math.max(containerWidth - margin.left - margin.right, data.length * 20); 
            const height = 300 - margin.top - margin.bottom;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const x = d3.scaleLinear()
                .domain(d3.extent(data, d => d.sum)).nice()
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.count)]).nice()
                .range([height, 0]);

            // Area generator
            const area = d3.area()
                .x(d => x(d.sum))
                .y0(y(0)) // Base of the area at y=0
                .y1(d => y(d.count))
                .curve(d3.curveBasis); // Smooth curve for density plot look

            // Add the area path
            svg.append("path")
                .datum(data)
                .attr("class", "area-path")
                .attr("d", area);

            // Add the dots for exact data points (optional, but good for clarity)
            svg.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => x(d.sum))
                .attr("cy", d => y(d.count))
                .attr("r", 3)
                .attr("fill", "black")
                .attr("opacity", 0.7);

            // Axes
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(10).tickFormat(d3.format("d"))); // Integer ticks

            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(y).ticks(5));
            
            // X-axis label
            svg.append("text")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("Sum of White Balls");

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 5)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("Frequency");


            // Tooltip (similar to previous, ensure it works with new elements)
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll(".dot") // Attach tooltip to dots
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`Sum: <strong>${d.sum}</strong><br>Frequency: <strong>${d.count}</strong>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }

        // NEW: Number Age Distribution Chart
        function renderNumberAgeChart(data) {
            const container = d3.select("#number-age-chart");
            container.html("");

            if (!data || data.length === 0) {
                container.append("p").text("No number age data available to display chart.").style("text-align", "center").style("color", "#6b7280");
                return;
            }

            const margin = { top: 20, right: 30, bottom: 50, left: 40 };
            const containerWidth = container.node().getBoundingClientRect().width;
            const width = Math.max(containerWidth - margin.left - margin.right, data.length * 25); // Ensure enough width for bars
            const height = 300 - margin.top - margin.bottom;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(data.map(d => d.age))
                .range([0, width])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.count)]).nice()
                .range([height, 0]);

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");
            
            // X-axis label
            svg.append("text")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("Number Since Last Appearance (Draws)");


            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(y).ticks(5));

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 5)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("Number of Balls (White & Powerball)");

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.age))
                .attr("y", d => y(d.count))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.count))
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`Age: <strong>${d.age} draws</strong><br>Count: <strong>${d.count}</strong>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }

        // NEW: Number Co-occurrence Heatmap
        function renderCoOccurrenceChart(data, maxVal) {
            const container = d3.select("#co-occurrence-chart");
            container.html("");

            if (!data || data.length === 0) {
                container.append("p").text("No co-occurrence data available to display chart.").style("text-align", "center").style("color", "#6b7280");
                return;
            }

            const whiteBallNumbers = d3.range(1, 70); // 1 to 69
            const margin = { top: 20, right: 20, bottom: 60, left: 60 };
            const containerWidth = container.node().getBoundingClientRect().width;
            const size = Math.min(containerWidth, 500); // Fixed size for square heatmap
            const width = size - margin.left - margin.right;
            const height = size - margin.top - margin.bottom;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales for X and Y axis (white ball numbers)
            const x = d3.scaleBand()
                .domain(whiteBallNumbers)
                .range([0, width])
                .paddingInner(0.05);

            const y = d3.scaleBand()
                .domain(whiteBallNumbers)
                .range([height, 0])
                .paddingInner(0.05);

            // Color scale for frequency
            const color = d3.scaleSequential(d3.interpolateBlues) // A blue color scheme
                .domain([0, maxVal]); // Max co-occurrence value

            // Add X-axis
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickValues(d3.range(0, 70, 5))) // Show every 5th tick
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");
            
            // X-axis label
            svg.append("text")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("White Ball Number 1");


            // Add Y-axis
            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(y).tickValues(d3.range(0, 70, 5))); // Show every 5th tick

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 5)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("White Ball Number 2");

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Add the cells
            svg.selectAll(".heatmap-cell")
                .data(data)
                .enter().append("rect")
                .attr("class", "heatmap-cell")
                .attr("x", d => x(d.x))
                .attr("y", d => y(d.y))
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", d => color(d.count))
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`Pair: (${d.x}, ${d.y})<br>Count: <strong>${d.count}</strong>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
            
            // Optionally, add a color legend (simple version)
            const legendScale = d3.scaleLinear()
                .domain([0, maxVal])
                .range([0, height]);

            const legendAxis = d3.axisRight(legendScale).ticks(5);

            const legend = svg.append("g")
                .attr("transform", `translate(${width + 10}, 0)`);

            legend.append("rect")
                .attr("width", 20)
                .attr("height", height)
                .attr("fill", "url(#gradient-blues)");

            legend.append("g")
                .call(legendAxis);

            // Define the gradient
            const defs = svg.append("defs");
            const linearGradient = defs.append("linearGradient")
                .attr("id", "gradient-blues")
                .attr("x1", "0%")
                .attr("y1", "100%")
                .attr("x2", "0%")
                .attr("y2", "0%");

            linearGradient.selectAll("stop")
                .data(color.ticks().map((t, i, j) => ({ offset: `${100 * i / (j.length - 1)}%`, color: color(t) })))
                .enter().append("stop")
                .attr("offset", d => d.offset)
                .attr("stop-color", d => d.color);
        }

        // NEW: Powerball Position Frequency Scatter Plot
        function renderPowerballPositionChart(data) {
            const container = d3.select("#powerball-position-chart");
            container.html("");

            if (!data || data.length === 0) {
                container.append("p").text("No Powerball position data available to display chart.").style("text-align", "center").style("color", "#6b7280");
                return;
            }

            const margin = { top: 20, right: 30, bottom: 50, left: 40 };
            const containerWidth = container.node().getBoundingClientRect().width;
            const width = Math.max(containerWidth - margin.left - margin.right, 400); // Fixed min width
            const height = 300 - margin.top - margin.bottom;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const x = d3.scalePoint() // Use scalePoint for discrete positions
                .domain(d3.range(1, 6)) // White Ball Positions 1 to 5
                .range([0, width])
                .padding(0.5); // Add padding to points

            const y = d3.scaleLinear()
                .domain([1, 26]).nice() // Powerball numbers 1 to 26
                .range([height, 0]);

            // Axes
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));
            
            // X-axis label
            svg.append("text")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("White Ball Position (1st to 5th)");

            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(y).ticks(5).tickFormat(d3.format("d"))); // Integer ticks

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 5)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .attr("fill", "#475569")
                .text("Powerball Number");

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Points
            svg.selectAll(".scatter-point")
                .data(data)
                .enter().append("circle")
                .attr("class", "scatter-point")
                .attr("cx", d => x(d.white_ball_position))
                .attr("cy", d => y(d.powerball_number))
                .attr("r", 3)
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`Position: <strong>${d.white_ball_position}</strong><br>Powerball: <strong>${d.powerball_number}</strong>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }


        // Keep a section open if it contains results from a form submission
        document.addEventListener('DOMContentLoaded', () => {
            const currentPath = window.location.pathname;
            const isPostRequest = {% if request.method == 'POST' %}true{% else %}false{% endif %};

            // Attach event listeners to all accordion headers
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', function() {
                    toggleAccordion(this);
                });
            });

            // Helper to click accordion header
            const openAccordion = (selector) => {
                const header = document.querySelector(selector);
                if (header && !header.classList.contains('active')) {
                    header.click();
                }
            };

            // Logic to open specific accordion based on data presence or route
            if (document.querySelector('.accordion-item:nth-child(1) .number-display') && (currentPath === '/generate' || isPostRequest)) {
                openAccordion('.accordion-item:nth-child(1) .accordion-header');
            } else if (document.querySelector('.accordion-item:nth-child(2) .number-display') && (currentPath === '/generate_modified' || isPostRequest)) {
                openAccordion('.accordion-item:nth-child(2) .accordion-header');
            } else if (document.querySelector('.accordion-item:nth-child(3) table') && (currentPath === '/find_results_by_first_white_ball' || isPostRequest)) {
                openAccordion('.accordion-item:nth-child(3) .accordion-header');
            }
            // For Analysis Tools, check which specific data is present
            else if (
                (document.querySelector('.accordion-item:nth-child(4) .scrollable-table-container') && (currentPath === '/frequency_analysis')) ||
                (document.querySelector('.accordion-item:nth-child(4) .scrollable-table-container') && (currentPath === '/hot_cold_numbers')) ||
                (document.querySelector('.accordion-item:nth-child(4) .scrollable-table-container') && (currentPath === '/monthly_white_ball_analysis')) ||
                (document.querySelector('#sum-distribution-chart') && (currentPath === '/sum_of_main_balls')) ||
                (document.querySelector('.accordion-item:nth-child(4) table') && (currentPath === '/find_results_by_sum' || isPostRequest)) ||
                (document.querySelector('.accordion-item:nth-child(4) table') && (currentPath === '/simulate_multiple_draws' || isPostRequest)) ||
                // Removed condition for hit_and_miss_analysis
                (document.querySelector('#number-age-chart') && (currentPath === '/number_age_distribution')) ||
                (document.querySelector('#co-occurrence-chart') && (currentPath === '/co_occurrence_analysis')) ||
                (document.querySelector('#powerball-position-chart') && (currentPath === '/powerball_position_frequency'))
            ) {
                openAccordion('.accordion-item:nth-child(4) .accordion-header');
                // Immediately check and render charts if this section is opened and data exists
                if (window.location.pathname === '/sum_of_main_balls' && sumFreqData && sumFreqData.length > 0) {
                    renderSumChart(sumFreqData);
                }
                if (window.location.pathname === '/number_age_distribution' && numberAgeData && numberAgeData.length > 0) {
                    renderNumberAgeChart(numberAgeData);
                }
                if (window.location.pathname === '/co_occurrence_analysis' && coOccurrenceData && coOccurrenceData.length > 0) {
                    renderCoOccurrenceChart(coOccurrenceData, maxCoOccurrence);
                }
                if (window.location.pathname === '/powerball_position_frequency' && powerballPositionData && powerballPositionData.length > 0) {
                    renderPowerballPositionChart(powerballPositionData);
                }
            }
            else if (document.querySelector('.accordion-item:nth-child(5) p') && (currentPath === '/winning_probability' || currentPath === '/partial_match_probabilities')) {
                openAccordion('.accordion-item:nth-child(5) .accordion-header');
            }
        });
    </script>
</body>
</html>
